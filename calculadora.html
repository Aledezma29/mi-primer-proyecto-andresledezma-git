<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora Simple</title>
  <style>
    :root { --bg:#0f172a; --panel:#111827; --btn:#1f2937; --accent:#3b82f6; --text:#e5e7eb; --muted:#94a3b8; }
    * { box-sizing: border-box; }
    body {
      margin: 0; min-height: 100vh; display: grid; place-items: center;
      background: linear-gradient(180deg,#0f172a 0,#111827 100%);
      font-family: system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,Cantarell,"Noto Sans","Helvetica Neue",Arial;
      color: var(--text);
    }
    .calc {
      width: min(420px, 92vw); background: rgba(17,24,39,.75);
      border: 1px solid #1f2937; border-radius: 16px; padding: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,.4);
    }
    .screen {
      background: #0b1220; border-radius: 12px; padding: 18px; height: 92px;
      display: flex; flex-direction: column; justify-content: center; align-items: flex-end; overflow: hidden;
    }
    .screen .prev { color: var(--muted); font-size: .95rem; min-height: 1.2em; }
    .screen .curr { font-size: clamp(1.6rem, 5vw + 1rem, 2.4rem); font-weight: 700; line-height: 1.1; word-break: break-all; }
    .keys { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 16px; }
    button {
      border: 0; border-radius: 12px; padding: 16px; font-size: 1.05rem; color: var(--text);
      background: var(--btn); cursor: pointer; transition: transform .02s, background .2s, box-shadow .2s;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
    }
    button:hover { background: #263244; }
    button:active { transform: scale(.98); }
    button.operator { background: #0f2a50; }
    button.operator.active { box-shadow: 0 0 0 2px var(--accent) inset; }
    button.equal { background: var(--accent); color: #fff; font-weight: 700; }
    button.span-2 { grid-column: span 2; }
    button.utility { background: #374151; }
    .brand { text-align: center; margin-top: 8px; font-size: .8rem; color: var(--muted); }
  </style>
</head>
<body>
  <main class="calc" aria-label="Calculadora">
    <div class="screen" aria-live="polite">
      <div class="prev" id="prev"></div>
      <div class="curr" id="curr">0</div>
    </div>

    <div class="keys">
      <button class="utility" data-action="clear" aria-label="Borrar todo">AC</button>
      <button class="utility" data-action="del" aria-label="Borrar último">DEL</button>
      <button class="utility" data-action="percent" aria-label="Porcentaje">%</button>
      <button class="operator" data-op="÷" aria-label="Dividir">÷</button>

      <button data-num="7">7</button>
      <button data-num="8">8</button>
      <button data-num="9">9</button>
      <button class="operator" data-op="×" aria-label="Multiplicar">×</button>

      <button data-num="4">4</button>
      <button data-num="5">5</button>
      <button data-num="6">6</button>
      <button class="operator" data-op="−" aria-label="Restar">−</button>

      <button data-num="1">1</button>
      <button data-num="2">2</button>
      <button data-num="3">3</button>
      <button class="operator" data-op="+" aria-label="Sumar">+</button>

      <button class="span-2" data-num="0">0</button>
      <button data-dot="." aria-label="Decimal">.</button>
      <button class="equal" data-action="equal" aria-label="Igual">=</button>
    </div>

    <p class="brand">Hecho con ♥</p>
  </main>

  <script>
    (() => {
      const prevEl = document.getElementById('prev');
      const currEl = document.getElementById('curr');

      let previous = '';
      let current = '0';
      let operator = null;
      let justEvaluated = false;

      const update = () => {
        prevEl.textContent = previous && operator ? `${previous} ${operator}` : '';
        currEl.textContent = current;
      };

      const clear = () => {
        previous = '';
        current = '0';
        operator = null;
        justEvaluated = false;
        setActiveOperator(null);
        update();
      };

      const del = () => {
        if (justEvaluated) { clear(); return; }
        current = (current.length <= 1) ? '0' : current.slice(0, -1);
        update();
      };

      const appendDigit = (d) => {
        if (justEvaluated) { current = d; justEvaluated = false; update(); return; }
        current = (current === '0') ? d : current + d;
        update();
      };

      const appendDot = () => {
        if (justEvaluated) { current = '0.'; justEvaluated = false; update(); return; }
        if (!current.includes('.')) { current += '.'; update(); }
      };

      const setActiveOperator = (op) => {
        document.querySelectorAll('button.operator').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.op === op);
        });
      };

      const chooseOperator = (op) => {
        if (operator && previous !== '' && current !== '') {
          const res = compute();
          previous = res;
          current = '';
        } else if (current !== '') {
          previous = current;
          current = '';
        }
        operator = op;
        justEvaluated = false;
        setActiveOperator(op);
        update();
      };

      const toNumber = (s) => (s === '' || s === '.') ? 0 : parseFloat(s);

      const formatResult = (n) => {
        const s = String(n);
        if (s.includes('e')) return n.toPrecision(10);
        return Number.isInteger(n) ? n.toString() : parseFloat(n.toFixed(10)).toString();
      };

      const compute = () => {
        const a = toNumber(previous);
        const b = toNumber(current);
        let r = 0;
        switch (operator) {
          case '+': r = a + b; break;
          case '−':
          case '-': r = a - b; break;
          case '×':
          case '*': r = a * b; break;
          case '÷':
          case '/':
            if (b === 0) return 'Error';
            r = a / b; break;
          default: r = b;
        }
        return formatResult(r);
      };

      const equal = () => {
        if (!operator || previous === '') return;
        const res = compute();
        if (res === 'Error') {
          current = 'Error'; previous = ''; operator = null;
          setActiveOperator(null); update(); justEvaluated = true; return;
        }
        current = res.toString();
        previous = '';
        operator = null;
        justEvaluated = true;
        setActiveOperator(null);
        update();
      };

      const percent = () => {
        let n = toNumber(current);
        if (operator && previous !== '') {
          const base = toNumber(previous);
          n = base * (n / 100);
        } else {
          n = n / 100;
        }
        current = formatResult(n);
        update();
      };

      // Click handlers
      document.querySelectorAll('[data-num]').forEach(b => b.addEventListener('click', e => appendDigit(e.currentTarget.dataset.num)));
      document.querySelectorAll('.operator').forEach(b => b.addEventListener('click', e => chooseOperator(e.currentTarget.dataset.op)));
      document.querySelector('[data-action="equal"]').addEventListener('click', equal);
      document.querySelector('[data-action="clear"]').addEventListener('click', clear);
      document.querySelector('[data-action="del"]').addEventListener('click', del);
      document.querySelector('[data-action="percent"]').addEventListener('click', percent);
      document.querySelector('[data-dot]').addEventListener('click', appendDot);

      // Teclado: 0-9 . , + - * / Enter = Backspace Esc %
      window.addEventListener('keydown', (e) => {
        const key = e.key;
        if (/\d/.test(key)) appendDigit(key);
        else if (key === '.' || key === ',') appendDot();
        else if (key === '+' || key === '-' || key === '*' || key === '/') {
          const opMap = { '+': '+', '-': '−', '*': '×', '/': '÷' };
          chooseOperator(opMap[key]);
        }
        else if (key === 'Enter' || key === '=') equal();
        else if (key === 'Backspace') del();
        else if (key === 'Escape') clear();
        else if (key === '%') percent();
      });

      // Estado inicial
      clear();
    })();
  </script>
</body>
</html>
